#!/bin/sh
set -e

echo "ğŸ” Running pre-commit checks..."

# Check if cargo and necessary tools are available
if ! command -v cargo &> /dev/null; then
    echo "âŒ cargo not found in PATH"
    exit 1
fi

# Format check
echo "ğŸ“ Checking code formatting..."
cargo fmt -- --check
if [ $? -ne 0 ]; then
    echo "âŒ Code is not formatted. Please run 'cargo fmt' and commit again."
    exit 1
fi

# Clippy lint
echo "ğŸ” Running clippy lints..."
cargo clippy -- -D warnings
if [ $? -ne 0 ]; then
    echo "âŒ Clippy found issues. Please fix them and commit again."
    exit 1
fi

# Run tests (quick unit tests only for pre-commit)
echo "ğŸ§ª Running unit tests..."
if command -v cargo-nextest &> /dev/null; then
    cargo nextest run --profile quick --lib
else
    cargo test --lib
fi
if [ $? -ne 0 ]; then
    echo "âŒ Tests failed. Please fix them and commit again."
    exit 1
fi

echo "âœ… All pre-commit checks passed!"